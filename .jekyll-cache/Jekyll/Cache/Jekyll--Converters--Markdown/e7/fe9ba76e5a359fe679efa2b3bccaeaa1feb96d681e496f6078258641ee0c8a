I"Õd<p>ë³¸ í¬ìŠ¤íŒ…ì€ â€œí˜¼ì ê³µë¶€í•˜ëŠ” ë¨¸ì‹ ëŸ¬ë‹+ë”¥ëŸ¬ë‹â€ ì±… ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
ì˜ëª»ëœ ë‚´ìš©ì´ ìˆì„ ê²½ìš° ì§€ì í•´ ì£¼ì‹œë©´ ê°ì‚¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤.</p>

<h2 id="5-1-íŒ¨ì…˜-mnist-ë°ì´í„°-ë¶ˆëŸ¬ì˜¤ê¸°">5-1. íŒ¨ì…˜ MNIST ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</h2>
<p>3ì¥ì—ì„œ ì™„ì „ ì—°ê²° ì‹ ê²½ë§ì— ì…ë ¥ ì´ë¯¸ì§€ë¥¼ ë°€ì§‘ì¸µì— ì—°ê²°í•˜ê¸° ìœ„í•´ ì¼ë ¬ë¡œ í¼ì³¤ë‹¤. í•©ì„±ê³± ì‹ ê²½ë§ì€ 2ì°¨ì› ì´ë¯¸ì§€ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ë¯€ë¡œ ì¼ë ¬ë¡œ í¼ì¹  í•„ìš”ê°€ ì—†ë‹¤. ë‹¤ë§Œ ì…ë ¥ ì´ë¯¸ì§€ëŠ” í•­ìƒ ê¹Šì´ ì°¨ì›ì´ ìˆì–´ì•¼ í•œë‹¤. <code class="language-plaintext highlighter-rouge">reshape()</code> ë©”ì†Œë“œë¡œ ì „ì²´ ë°°ì—´ ì°¨ì›ì„ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ë©´ì„œ ë§ˆì§€ë§‰ì— ì°¨ì›ì„ ê°„ë‹¨íˆ ì¶”ê°€í•˜ì.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="p">(</span><span class="n">train_input</span><span class="p">,</span> <span class="n">train_target</span><span class="p">),</span> <span class="p">(</span><span class="n">test_input</span><span class="p">,</span> <span class="n">test_target</span><span class="p">)</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">datasets</span><span class="p">.</span><span class="n">fashion_mnist</span><span class="p">.</span><span class="n">load_data</span><span class="p">()</span>
<span class="n">train_scaled</span> <span class="o">=</span> <span class="n">train_input</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.0</span>
<span class="n">train_scaled</span><span class="p">,</span> <span class="n">val_scaled</span><span class="p">,</span> <span class="n">train_target</span><span class="p">,</span> <span class="n">val_target</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">train_scaled</span><span class="p">,</span> <span class="n">train_target</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</code></pre></div></div>

<p>(48000, 28, 28) í¬ê¸°ê°€ (48000, 28 ,28, 1) í¬ê¸°ê°€ ëë‹¤.</p>

<h2 id="5-2-í•©ì„±ê³±-ì‹ ê²½ë§-ë§Œë“¤ê¸°">5-2. í•©ì„±ê³± ì‹ ê²½ë§ ë§Œë“¤ê¸°</h2>
<p>í•©ì„±ê³± ì‹ ê²½ë§ êµ¬ì¡°ëŠ” í•©ì„±ê³± ì¸µìœ¼ë¡œ ì´ë¯¸ì§€ì—ì„œ íŠ¹ì§•ì„ ê°ì§€í•œ í›„ ë°€ì§‘ì¸µìœ¼ë¡œ í´ë˜ìŠ¤ì— ë”°ë¥¸ ë¶„ë¥˜ í™•ë¥ ì„ ê³„ì‚°í•œë‹¤.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s">'same'</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
<span class="n">model</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">MaxPooling2D</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div></div>

<p>í•©ì„±ê³± ì¸µì—ì„œ 32ê°œ í•„í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ íŠ¹ì„± ë§µì˜ ê¹Šì´ëŠ” 32ê°€ ëœë‹¤. (2, 2) ìµœëŒ€ í’€ë§ì„ ì ìš©í•˜ì—¬ íŠ¹ì„± ë§µì˜ í¬ê¸°ëŠ” ì ˆë°˜ìœ¼ë¡œ ì¤„ì–´ë“ ë‹¤. ë‘ ë²ˆì§¸ í•©ì„±ê³±-í’€ë§ ì¸µë„ ì¶”ê°€í•´ë³´ì.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s">'same'</span><span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">MaxPooling2D</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div></div>

<p>64ê°œì˜ í•„í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ìµœì¢…ì ìœ¼ë¡œ ë§Œë“¤ì–´ì§€ëŠ” íŠ¹ì„± ë§µì˜ í¬ê¸°ëŠ” (7, 7, 64)ê°€ ëœë‹¤.</p>

<p>ì´ì œ 3ì°¨ì› íŠ¹ì„± ë§µì„ ì¼ë ¬ë¡œ í¼ì¹˜ê³  ì™„ì „ ì—°ê²° ì‹ ê²½ë§ì„ ë§Œë“¤ì.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Flatten</span><span class="p">())</span>
<span class="n">model</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">))</span>
<span class="n">model</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.4</span><span class="p">))</span>
<span class="n">model</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'softmax'</span><span class="p">))</span>
</code></pre></div></div>

<p>ì€ë‹‰ì¸µê³¼ ì¶œë ¥ì¸µ ì‚¬ì´ì— ë“œë¡­ì•„ì›ƒì„ ë„£ì—ˆë‹¤. ë“œë¡­ì•„ì›ƒ ì¸µì´ ì€ë‹‰ì¸µì˜ ê³¼ëŒ€ì í•©ì„ ë§‰ì•„ ì„±ëŠ¥ì„ ì¡°ê¸ˆ ë” ê°œì„ í•´ ì¤„ ê²ƒì´ë‹¤. íŒ¨ì…˜ MNIST ë°ì´í„°ì…‹ì€ í´ë˜ìŠ¤ 10ê°œë¥¼ ë¶„ë¥˜í•˜ëŠ” ë‹¤ì¤‘ ë¶„ë¥˜ ë¬¸ì œì´ë‹¤. ë§ˆì§€ë§‰ ì¸µì˜ í™œì„±í™” í•¨ìˆ˜ëŠ” ì†Œí”„íŠ¸ë§¥ìŠ¤ë¥¼ ì‚¬ìš©í•œë‹¤. ì´ì œ <code class="language-plaintext highlighter-rouge">summary()</code> ë©”ì†Œë“œë¡œ ëª¨ë¸ êµ¬ì¡°ë¥¼ ì¶œë ¥í•´ë³´ì.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span><span class="p">.</span><span class="n">summary</span><span class="p">()</span>
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ê²°ê³¼) Model: "sequential_1"
       _________________________________________________________________
       Layer (type)                 Output Shape              Param #   
       =================================================================
       conv2d_4 (Conv2D)            (None, 28, 28, 32)        320       
       _________________________________________________________________
       max_pooling2d_1 (MaxPooling2 (None, 14, 14, 32)        0         
       _________________________________________________________________
       conv2d_5 (Conv2D)            (None, 14, 14, 64)        18496     
       _________________________________________________________________
       max_pooling2d_2 (MaxPooling2 (None, 7, 7, 64)          0         
       _________________________________________________________________
       flatten_1 (Flatten)          (None, 3136)              0         
       _________________________________________________________________
       dense_2 (Dense)              (None, 100)               313700    
       _________________________________________________________________
       dropout_1 (Dropout)          (None, 100)               0         
       _________________________________________________________________
       dense_3 (Dense)              (None, 10)                1010      
       =================================================================
       Total params: 333,526
       Trainable params: 333,526
       Non-trainable params: 0
       _________________________________________________________________
</code></pre></div></div>

<p>ì²«ë²ˆì§¸ íŒŒë¼ë¯¸í„° ê°œìˆ˜ëŠ” 3x3x32+32=320 ì‹ì— ì˜í•´ ì‚°ì¶œëœë‹¤. ë‘ë²ˆì§¸ íŒŒë¼ë¯¸í„° ê°œìˆ˜ëŠ” 3x3x32x64+64=18496 ì‹ì— ì˜í•´ ë‚˜ì˜¨ë‹¤. ì„¸ë²ˆì§¸ íŒŒë¼ë¯¸í„° ê°œìˆ˜ëŠ” 3136x100+100=313700 ì‹ìœ¼ë¡œ ë‚˜ì˜¤ë©° ë§ˆì§€ë§‰ íŒŒë¼ë¯¸í„° ê°œìˆ˜ëŠ” 100x10+10 ì‹ì— ì˜í•´ ë‚˜ì˜¨ë‹¤. í•„í„°ë§ˆë‹¤ í•˜ë‚˜ì˜ ì ˆí¸ì´ ìˆë‹¤ëŠ” ê²ƒì„ ê¼­ ê¸°ì–µí•˜ì!<br />
ì¼€ë¼ìŠ¤ëŠ” <code class="language-plaintext highlighter-rouge">summary()</code> ë©”ì†Œë“œ ì™¸ì—ë„ ì¸µì˜ êµ¬ì„±ì„ ê·¸ë¦¼ìœ¼ë¡œ í‘œí˜„í•´ì£¼ëŠ” <code class="language-plaintext highlighter-rouge">plot_model()</code> í•¨ìˆ˜ë¥¼ ì œê³µí•œë‹¤.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">keras</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">plot_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</code></pre></div></div>
<p>ê·¸ë¦¼ ë„£ê¸°</p>

<p><code class="language-plaintext highlighter-rouge">plot_model()</code> í•¨ìˆ˜ì˜ <code class="language-plaintext highlighter-rouge">show_shapes</code> ë§¤ê°œë³€ìˆ˜ë¥¼ Trueë¡œ ì„¤ì •í•˜ë©´ ê·¸ë¦¼ì— ì…ë ¥ê³¼ ì¶œë ¥ì˜ í¬ê¸°ë¥¼ í‘œì‹œí•´ì¤€ë‹¤. ë˜í•œ <code class="language-plaintext highlighter-rouge">to_file</code> ë§¤ê°œë³€ìˆ˜ì— íŒŒì¼ ì´ë¦„ì„ ì§€ì •í•˜ë©´ ì¶œë ¥í•œ ì´ë¯¸ì§€ë¥¼ íŒŒì¼ë¡œ ì €ì¥í•œë‹¤. <code class="language-plaintext highlighter-rouge">dpi</code> ë§¤ê°œë³€ìˆ˜ë¡œ í•´ìƒë„ë„ ì§€ì •í•  ìˆ˜ ìˆë‹¤.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">keras</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">plot_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">to_file</span><span class="o">=</span><span class="s">'cnn-architecture.png'</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</code></pre></div></div>
<p>ê·¸ë¦¼ë„£ê¸°</p>

<h2 id="5-3-ëª¨ë¸-ì»´íŒŒì¼ê³¼-í›ˆë ¨">5-3. ëª¨ë¸ ì»´íŒŒì¼ê³¼ í›ˆë ¨</h2>
<p>ì¼€ë¼ìŠ¤ APIì˜ ì¥ì ì€ ë”¥ëŸ¬ë‹ ëª¨ë¸ì˜ ì¢…ë¥˜ë‚˜ êµ¬ì„± ë°©ì‹ì— ìƒê´€ì—†ì´ ì»´íŒŒì¼ê³¼ í›ˆë ¨ ê³¼ì •ì´ ê°™ë‹¤ëŠ” ê²ƒì´ë‹¤. <code class="language-plaintext highlighter-rouge">Adam</code> ì˜µí‹°ë§ˆì´ì €ë¥¼ ì‚¬ìš©í•˜ê³  <code class="language-plaintext highlighter-rouge">ModelCheckpoint</code> ì½œë°±ê³¼ <code class="language-plaintext highlighter-rouge">EarlyStoppig</code> ì½œë°±ì„ í•¨ê»˜ ì‚¬ìš©í•´ ì¡°ê¸° ì¢…ë£Œ ê¸°ë²•ì„ êµ¬í˜„í•˜ì.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span><span class="p">.</span><span class="nb">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s">'adam'</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s">'sparse_categorical_crossentropy'</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="s">'accuracy'</span><span class="p">)</span>
<span class="n">checkpoint_cb</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">callbacks</span><span class="p">.</span><span class="n">ModelCheckpoint</span><span class="p">(</span><span class="s">'beset-cnn-model.h5'</span><span class="p">)</span>
<span class="n">early_stopping_cb</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">callbacks</span><span class="p">.</span><span class="n">EarlyStopping</span><span class="p">(</span><span class="n">patience</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">restore_best_weights</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_scaled</span><span class="p">,</span> <span class="n">train_target</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">val_scaled</span><span class="p">,</span> <span class="n">val_target</span><span class="p">),</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">checkpoint_cb</span><span class="p">,</span> <span class="n">early_stopping_cb</span><span class="p">])</span>
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ê²°ê³¼) Epoch 1/20
       1500/1500 [==============================] - 37s 24ms/step - loss: 0.5345 - accuracy: 0.8059 - val_loss: 0.3720 - val_accuracy: 0.8556
       Epoch 2/20
       1500/1500 [==============================] - 37s 24ms/step - loss: 0.3575 - accuracy: 0.8724 - val_loss: 0.2879 - val_accuracy: 0.8920
       Epoch 3/20
       1500/1500 [==============================] - 37s 25ms/step - loss: 0.3047 - accuracy: 0.8894 - val_loss: 0.2647 - val_accuracy: 0.9031
       Epoch 4/20
       1500/1500 [==============================] - 37s 25ms/step - loss: 0.2702 - accuracy: 0.9015 - val_loss: 0.2447 - val_accuracy: 0.9086
       Epoch 5/20
       1500/1500 [==============================] - 39s 26ms/step - loss: 0.2453 - accuracy: 0.9101 - val_loss: 0.2362 - val_accuracy: 0.9103
       Epoch 6/20
       1500/1500 [==============================] - 38s 25ms/step - loss: 0.2275 - accuracy: 0.9165 - val_loss: 0.2226 - val_accuracy: 0.9137
       Epoch 7/20
       1500/1500 [==============================] - 37s 25ms/step - loss: 0.2059 - accuracy: 0.9249 - val_loss: 0.2210 - val_accuracy: 0.9186
       Epoch 8/20
       1500/1500 [==============================] - 37s 25ms/step - loss: 0.1943 - accuracy: 0.9295 - val_loss: 0.2262 - val_accuracy: 0.9180
       Epoch 9/20
       1500/1500 [==============================] - 39s 26ms/step - loss: 0.1780 - accuracy: 0.9340 - val_loss: 0.2355 - val_accuracy: 0.9144
</code></pre></div></div>

<p>ì¡°ê¸° ì¢…ë£Œê°€ ì˜ ì´ë£¨ì–´ì¡ŒëŠ”ì§€ í™•ì¸í•´ë³´ì.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="p">.</span><span class="n">history</span><span class="p">[</span><span class="s">'loss'</span><span class="p">])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="p">.</span><span class="n">history</span><span class="p">[</span><span class="s">'val_loss'</span><span class="p">])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'epoch'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'loss'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">([</span><span class="s">'train'</span><span class="p">,</span> <span class="s">'val'</span><span class="p">])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>
<p class="align-center"><img src="/assets/images/deeplearningtens/5-3.png" alt="ê·¸ë¦¼ 5-3. ì½”ë“œ ê²°ê³¼" /></p>
<p>ê·¸ë¦¼ 5-3. ì½”ë“œ ê²°ê³¼</p>

<p>ê²€ì¦ ì„¸íŠ¸ì— ëŒ€í•œ ì†ì‹¤ì´ ì ì°¨ ê°ì†Œí•˜ë‹¤ê°€ ì •ì²´ë˜ê¸° ì‹œì‘í•˜ê³  í›ˆë ¨ ì„¸íŠ¸ì— ëŒ€í•œ ì†ì‹¤ì€ ì ì  ë” ë‚®ì•„ì§€ê³  ìˆë‹¤. <code class="language-plaintext highlighter-rouge">EarlyStopping</code> í´ë˜ìŠ¤ì—ì„œ <code class="language-plaintext highlighter-rouge">resotre_best_weights=True</code>ë¡œ ì €ì¥í–ˆìœ¼ë¯€ë¡œ í˜„ì¬ model ê°ì²´ê°€ ìµœì ì˜ ëª¨ë¸ íŒŒë¼ë¯¸í„°ë¡œ ë³µì›ë˜ì–´ ìˆë‹¤. ì¦‰ <code class="language-plaintext highlighter-rouge">ModelCheckpoint</code> ì½œë°±ì´ ì €ì¥í•œ <code class="language-plaintext highlighter-rouge">best-cnn-model.h5</code> íŒŒì¼ì„ ë‹¤ì‹œ ì½ì„ í•„ìš”ê°€ ì—†ë‹¤. ì´ì œ ì„¸íŠ¸ì— ëŒ€í•œ ì„±ëŠ¥ì„ í™•ì¸í•´ë³´ì.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span><span class="p">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">val_scaled</span><span class="p">,</span> <span class="n">val_target</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ê²°ê³¼) 375/375 [==============================] - 3s 8ms/step - loss: 0.2210 - accuracy: 0.9186
       [0.2210034728050232, 0.918583333492279]
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">EarlyStopping</code> ì½œë°±ì´ model ê°ì²´ë¥¼ ìµœìƒì˜ ëª¨ë¸ íŒŒë¼ë¯¸í„°ë¡œ ì˜ ë³µì›í•œ ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤. 3ì°¨ì› ë°°ì—´ì„ 2ì°¨ì› í˜•íƒœë¡œ ë°”ê¾¸ì–´ ì´ë¯¸ì§€ë¥¼ ì¶œë ¥í•´ë³´ì.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">val_scaled</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">reshape</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s">'gray_r'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>
<p class="align-center"><img src="/assets/images/deeplearningtens/5-4.png" alt="ê·¸ë¦¼ 5-4. ì½”ë“œ ê²°ê³¼" /></p>
<p>ê·¸ë¦¼ 5-4. ì½”ë“œ ê²°ê³¼</p>

<p>í•¸ë“œë°± ì´ë¯¸ì§€ë¡œ ë³´ì¸ë‹¤. <code class="language-plaintext highlighter-rouge">predict()</code> ì—ì„œ 10ê°œì˜ í´ë˜ìŠ¤ì— ëŒ€í•œ ì˜ˆì¸¡ í™•ë¥ ì„ ì¶œë ¥í•˜ì.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">val_scaled</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ê²°ê³¼) [[1.2923547e-15 2.0240659e-23 2.0993377e-17 2.7453213e-17 1.8608113e-17   2.1668218e-16 5.5988666e-16 1.1345319e-16 1.0000000e+00 9.9846664e-18]]
</code></pre></div></div>

<p>ì°¸ê³ ë¡œ ìŠ¬ë¼ì´ì‹± ì—°ì‚°ì„ ì‚¬ìš©í•œ ì´ìœ ëŠ” (28, 28, 1) ì´ ì•„ë‹Œ (1, 28, 28, 1) í¬ê¸°ë¥¼ ë§Œë“¤ê¸° ìœ„í•¨ì´ë‹¤. <code class="language-plaintext highlighter-rouge">evaluate()</code> ë©”ì†Œë“œëŠ” ëª¨ë‘ ì…ë ¥ì˜ ì²« ë²ˆì§¸ ì°¨ì›ì´ ë°°ì¹˜ ì°¨ì›ì¼ ê²ƒìœ¼ë¡œ ê¸°ëŒ€í•œë‹¤. ë§‰ëŒ€ ê·¸ë˜í”„ë¡œ ê° í™•ë¥ ì´ ëª‡ì¸ì§€ í™•ì¸í•´ë³´ì.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="n">preds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'class'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>
<p class="align-center"><img src="/assets/images/deeplearningtens/5-5.png" alt="ê·¸ë¦¼ 5-5. ì½”ë“œ ê²°ê³¼" /></p>
<p>ê·¸ë¦¼ 5-5. ì½”ë“œ ê²°ê³¼</p>

<p>ê° ë ˆì´ë¸”ì„ ë¦¬ìŠ¤íŠ¸ë¡œ ì €ì¥í•˜ê³  <code class="language-plaintext highlighter-rouge">preds</code> ë°°ì—´ì—ì„œ ê°€ì¥ í° ì¸ë±ìŠ¤ë¥¼ ì°¾ì•„ <code class="language-plaintext highlighter-rouge">classes</code> ë¦¬ìŠ¤íŠ¸ì˜ ì¸ë±ìŠ¤ë¡œ ì‚¬ìš©í•´ë³´ì.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="s">'í‹°ì…”ì¸ '</span><span class="p">,</span> <span class="s">'ë°”ì§€'</span><span class="p">,</span> <span class="s">'ìŠ¤ì›¨í„°'</span><span class="p">,</span> <span class="s">'ë“œë ˆìŠ¤'</span><span class="p">,</span> <span class="s">'ì½”íŠ¸'</span><span class="p">,</span> <span class="s">'ìƒŒë‹¬'</span><span class="p">,</span> <span class="s">'ì…”ì¸ '</span><span class="p">,</span> <span class="s">'ìŠ¤ë‹ˆì»¤ì¦ˆ'</span><span class="p">,</span> <span class="s">'ê°€ë°©'</span><span class="p">,</span> <span class="s">'ì•µí´ ë¶€ì¸ '</span><span class="p">]</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="k">print</span><span class="p">(</span><span class="n">classes</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">preds</span><span class="p">)])</span>
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ê²°ê³¼) ê°€ë°©
</code></pre></div></div>

<p>ê°€ë°©ìœ¼ë¡œ ì˜ ì˜ˆì¸¡í•˜ì˜€ë‹¤. í…ŒìŠ¤íŠ¸ ì…‹ì— ëŒ€í•´ì„œë„ í”½ì…€ê°’ì˜ ë²”ìœ„ë¥¼ 0~1 ì‚¬ì´ë¡œ ë°”ê¾¸ê³  ì´ë¯¸ì§€ë¥¼ (28, 28)ì—ì„œ (28, 28, 1)ë¡œ ë°”ê¾¸ê³  <code class="language-plaintext highlighter-rouge">evaluate()</code> ë©”ì†Œë“œë¡œ í…ŒìŠ¤íŠ¸ ì„¸íŠ¸ì— ëŒ€í•œ ì„±ëŠ¥ì„ ì¸¡ì •í•´ë³´ì.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test_scaled</span><span class="o">=</span><span class="n">test_input</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.0</span>
<span class="n">model</span><span class="p">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_scaled</span><span class="p">,</span> <span class="n">test_target</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ê²°ê³¼) 313/313 [==============================] - 3s 8ms/step - loss: 0.2503 - accuracy: 0.9105
       [0.2503235638141632, 0.9104999899864197]
</code></pre></div></div>

<p>ì•½ 91%ì˜ ì„±ëŠ¥ì´ ë‚˜ì™”ë‹¤!</p>
:ET
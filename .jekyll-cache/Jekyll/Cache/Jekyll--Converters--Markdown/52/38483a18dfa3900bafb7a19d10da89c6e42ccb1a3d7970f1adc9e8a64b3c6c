I"Ÿw<p>ë³¸ í¬ìŠ¤íŒ…ì€ â€œí˜¼ì ê³µë¶€í•˜ëŠ” ë¨¸ì‹ ëŸ¬ë‹+ë”¥ëŸ¬ë‹â€ ì±… ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
ì˜ëª»ëœ ë‚´ìš©ì´ ìˆì„ ê²½ìš° ì§€ì í•´ ì£¼ì‹œë©´ ê°ì‚¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤.</p>

<h2 id="6-1-ê°€ì¤‘ì¹˜-ì‹œê°í™”">6-1. ê°€ì¤‘ì¹˜ ì‹œê°í™”</h2>
<p>í•©ì„±ê³± ì¸µì€ ì—¬ëŸ¬ ê°œì˜ í•„í„°ë¥¼ ì‚¬ìš©í•´ ì´ë¯¸ì§€ì—ì„œ íŠ¹ì§•ì„ í•™ìŠµí•œë‹¤. ê° í•„í„°ëŠ” ì»¤ë„ì´ë¼ ë¶€ë¥´ëŠ” ê°€ì¤‘ì¹˜ì™€ ì ˆí¸ì„ ê°–ëŠ”ë‹¤. ì ˆí¸ì€ ì‚¬ì‹¤ ì‹œê°ì ìœ¼ë¡œ ì˜ë¯¸ê°€ ìˆì§€ëŠ” ì•Šë‹¤. ê°€ì¤‘ì¹˜ëŠ” ì…ë ¥ ì´ë¯¸ì§€ì˜ 2ì°¨ì› ì˜ì—­ì— ì ìš©ë˜ì–´ ì–´ë–¤ íŠ¹ì§•ì„ í¬ê²Œ ë‘ë“œëŸ¬ì§€ê²Œ í‘œí˜„í•˜ëŠ” ì—­í• ì„ í•œë‹¤.<br />
ë§Œì•½ ë‘¥ê·¼ ëª¨ì„œë¦¬ë¥¼ ë½‘ì•„ë‚´ëŠ” í•„í„°ê°€ ìˆë‹¤ê³  í•˜ì. ì´ í•„í„°ì˜ ê°€ì¤‘ì¹˜ëŠ” ë‘¥ê·¼ ëª¨ì„œë¦¬ê°€ ìˆëŠ” ì˜ì—­ì—ì„œ í¬ê²Œ í™œì„±í™” ë˜ê³ , ê·¸ë ‡ì§€ ì•Šì€ ì˜ì—­ì—ì„œëŠ” ë‚®ì€ ê°’ì„ ë§Œë“ ë‹¤. ì¦‰, ê³¡ì„  ë¶€ë¶„ì˜ ê°€ì¤‘ì¹˜ ê°’ì€ ë†’ê³ , ê·¸ ì™¸ ë¶€ë¶„ì˜ ê°€ì¤‘ì¹˜ ê°’ëŠ” ë‚®ì„ ê²ƒì´ë‹¤.<br />
5ì¥ì—ì„œ ë§Œë“  ëª¨ë¸ì„ ë¶ˆëŸ¬ì˜¤ì.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">models</span><span class="p">.</span><span class="n">load_model</span><span class="p">(</span><span class="s">'best-cnn-model.h5'</span><span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="n">layers</span>
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ê²°ê³¼) [&lt;tensorflow.python.keras.layers.convolutional.Conv2D at 0x245e6418f28&gt;,
       &lt;tensorflow.python.keras.layers.pooling.MaxPooling2D at 0x245e6447860&gt;,
       &lt;tensorflow.python.keras.layers.convolutional.Conv2D at 0x245e6487ba8&gt;,
       &lt;tensorflow.python.keras.layers.pooling.MaxPooling2D at 0x245e66b23c8&gt;,
       &lt;tensorflow.python.keras.layers.core.Flatten at 0x245e66b26a0&gt;,
       &lt;tensorflow.python.keras.layers.core.Dense at 0x245e66bc320&gt;,
       &lt;tensorflow.python.keras.layers.core.Dropout at 0x245e66bc710&gt;,
       &lt;tensorflow.python.keras.layers.core.Dense at 0x245e66bce48&gt;]
</code></pre></div></div>

<p>ì²« ë²ˆì§¸ í•©ì„±ê³± ì¸µì˜ ê°€ì¤‘ì¹˜ë¥¼ ë³´ì. ì¸µì˜ ê°€ì¤‘ì¹˜ì™€ ì ˆí¸ì€ <code class="language-plaintext highlighter-rouge">weights</code> ì†ì„±ì— ì €ì¥ë˜ì–´ ìˆë‹¤.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">conv</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">conv</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">shape</span><span class="p">,</span> <span class="n">conv</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ê²°ê³¼) (3, 3, 1, 32) (32,)
</code></pre></div></div>

<p>ì»¤ë„ í¬ê¸°ê°€ 3x3 ì´ì—ˆê³ , ì…ë ¥ì˜ ê¹Šì´ëŠ” 1ì´ì—ˆë‹¤. ì¶œë ¥ í•„í„° ê°œìˆ˜ê°€ 32ê°œ ì˜€ìœ¼ë¯€ë¡œ ì˜¬ë°”ë¥´ê²Œ ì¶œë ¥ë˜ì—ˆë‹¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. í•„í„°ë§ˆë‹¤ 1ê°œì˜ ì ˆí¸ì´ ìˆìœ¼ë¯€ë¡œ ì ˆí¸ë„ 32ê°œê°€ ë§ë‹¤. weights ì†ì„±ì€ ë‹¤ì°¨ì› ë°°ì—´ì¸ Tensor í´ë˜ìŠ¤ì˜ ê°ì²´ì´ë‹¤. ë‹¤ë£¨ê¸° ì‰½ë„ë¡ <code class="language-plaintext highlighter-rouge">numpy()</code> ë©”ì†Œë“œë¡œ ë„˜íŒŒì´ ë°°ì—´ë¡œ ë³€í™˜í•˜ê³  ê°€ì¤‘ì¹˜ ë°°ì—´ì˜ í‰ê· ê³¼ í‘œì¤€í¸ì°¨ë¥¼ êµ¬í•´ë³´ì.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">conv_weights</span> <span class="o">=</span> <span class="n">conv</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">numpy</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">conv_weights</span><span class="p">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">conv_weights</span><span class="p">.</span><span class="n">std</span><span class="p">())</span>
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ê²°ê³¼) -0.009519433 0.23307213
</code></pre></div></div>

<p>ê°€ì¤‘ì¹˜ì˜ í‰ê· ì´ 0ì— ê°€ê¹ê³ , í‘œì¤€í¸ì°¨ëŠ” 0.23 ì •ë„ì´ë‹¤. ì´ ê°€ì¤‘ì¹˜ê°€ ì–´ë–¤ ë¶„í¬ë¥¼ ê°€ì¡ŒëŠ”ì§€ í™•ì¸í•´ë³´ì.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="n">plt</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">conv_weights</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="c1"># (288, 1)
</span><span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'weight'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'count'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">,</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>
<p class="align-center"><img src="/assets/images/deeplearningtens/6-1.png" alt="ê·¸ë¦¼ 6-1. ì½”ë“œ ê²°ê³¼" /></p>
<p>ê·¸ë¦¼ 6-1. ì½”ë“œ ê²°ê³¼</p>

<p><code class="language-plaintext highlighter-rouge">hist()</code> í•¨ìˆ˜ë¡œ íˆìŠ¤í† ê·¸ë¨ì„ ê·¸ë¦¬ë ¤ë©´ 1ì°¨ì› ë°°ì—´ì´ ì „ë‹¬ë˜ì–´ì•¼ í•œë‹¤. íˆìŠ¤í† ê·¸ë¨ì„ ë³´ë©´ 0ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì¢… ëª¨ì–‘ ë¶„í¬ë¥¼ ë ê³  ìˆìŒì„ ë³¼ ìˆ˜ ìˆë‹¤. ì´ ì ì„ ì¼ë‹¨ ì£¼ëª©í•˜ì.<br />
ì´ë²ˆì—ëŠ” 32ê°œì˜ ì»¤ë„ì„ ì¶œë ¥í•´ë³´ì.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">].</span><span class="n">imshow</span><span class="p">(</span><span class="n">conv_weights</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="o">*</span><span class="mi">16</span><span class="o">+</span><span class="n">j</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">].</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>
<p class="align-center"><img src="/assets/images/deeplearningtens/6-2.png" alt="ê·¸ë¦¼ 6-2. ì½”ë“œ ê²°ê³¼" /></p>
<p>ê·¸ë¦¼ 6-2. ì½”ë“œ ê²°ê³¼</p>

<p>ë°ì€ ë¶€ë¶„ì˜ ê°’ì´ ê°€ì¥ ë†’ë‹¤í•  ìˆ˜ ìˆë‹¤. ì²« ë²ˆì§¸ ì¤„ì˜ ë§¨ ì™¼ìª½ ê°€ì¤‘ì¹˜ëŠ” ì˜¤ë¥¸ìª½ 3í”½ì…€ ê°’ì´ ê°€ì¥ ë†’ë‹¤. ì´ ê°€ì¤‘ì¹˜ëŠ” ì˜¤ë¥¸ìª½ì— ë†“ì¸ ì§ì„ ì„ ë§Œë‚˜ë©´ í¬ê²Œ í™œì„±í™” ë  ê²ƒì´ë‹¤. ì°¸ê³ ë¡œ <code class="language-plaintext highlighter-rouge">imshow()</code>ì˜ <code class="language-plaintext highlighter-rouge">vmin</code>ê³¼ <code class="language-plaintext highlighter-rouge">vmax</code>ëŠ” ì ˆëŒ€ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ í”½ì…€ì˜ ê°•ë„ë¥¼ ë‚˜íƒ€ë‚´ê¸° ìœ„í•´ ì‚¬ìš©í–ˆë‹¤. ì¦‰ ê·¸ ë°°ì—´ì˜ ìµœëŒ€ê°’ì´ë©´ ê°€ì¥ ë°ì€ ë…¸ë€ìƒ‰ìœ¼ë¡œ ê·¸ë¦¬ëŠ” ê²ƒì´ë‹¤.<br />
ì´ì œ í›ˆë ¨í•˜ì§€ ì•Šì€ ë¹ˆ í•©ì„±ê³± ì‹ ê²½ë§ì„ ë§Œë“¤ê³ , ì´ í•©ì„±ê³±ì˜ ê°€ì¤‘ì¹˜ê°€ ìœ„ ì½”ë“œì—ì„œ ë³¸ í›ˆë ¨ëœ ê°€ì¤‘ì¹˜ì™€ ì–´ë–»ê²Œ ë‹¤ë¥¸ì§€ ë³´ì.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">no_training_model</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">no_training_model</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s">'same'</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
<span class="n">no_training_conv</span> <span class="o">=</span> <span class="n">no_training_model</span><span class="p">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">no_training_conv</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">shape</span><span class="p">)</span>

<span class="n">no_training_weights</span> <span class="o">=</span> <span class="n">no_training_conv</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">numpy</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">no_training_weights</span><span class="p">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">no_training_weights</span><span class="p">.</span><span class="n">std</span><span class="p">())</span>

<span class="n">plt</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">no_training_weights</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'weight'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'count'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>
<div class="language-plaintext align-center highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ê²°ê³¼) (3, 3, 1, 32)
       0.007826313 0.0833402 ![ê·¸ë¦¼ 6-3. ì½”ë“œ ê²°ê³¼](/assets/images/deeplearningtens/6-3.png)
</code></pre></div></div>
<p>ê·¸ë¦¼ 6-3. ì½”ë“œ ê²°ê³¼</p>

<p>í™•ì‹¤íˆ ì´ì „ê³¼ ë‹¤ë¥´ë‹¤. ëŒ€ë¶€ë¶„ì˜ ê°€ì¤‘ì¹˜ê°€ -0.15~0.15 ì‚¬ì´ì— ë¹„êµì  ê³ ë¥´ê²Œ ë¶„í¬í•˜ê³  ìˆë‹¤. ì´ëŸ° ëª¨ì–‘ì¸ ì´ìœ ëŠ” ë°”ë¡œ í…ì„œí”Œë¡œê°€ ì‹ ê²½ë§ì˜ ê°€ì¤‘ì¹˜ë¥¼ ì²˜ìŒ ì´ˆê¸°í™”í•  ë•Œ ê· ë“± ë¶„í¬ì—ì„œ ëœë¤í•˜ê²Œ ê°’ì„ ì„ íƒí•˜ê¸° ë•Œë¬¸ì´ë‹¤.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">].</span><span class="n">imshow</span><span class="p">(</span><span class="n">no_training_weights</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="o">*</span><span class="mi">16</span><span class="o">+</span><span class="n">j</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">].</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>
<p class="align-center"><img src="/assets/images/deeplearningtens/6-4.png" alt="ê·¸ë¦¼ 6-4. ì½”ë“œ ê²°ê³¼" /></p>
<p>ê·¸ë¦¼ 6-4. ì½”ë“œ ê²°ê³¼</p>

<p>ì „ì²´ì ìœ¼ë¡œ í•„í„°ì˜ ê°€ì¤‘ì¹˜ê°€ ë°‹ë°‹í•˜ê²Œ ì´ˆê¸°í™”ëë‹¤. ì´ ê·¸ë¦¼ì„ í›ˆë ¨ì„ ë§ˆì¹œ ê°€ì¤‘ì¹˜ì™€ ë¹„êµí•˜ë©´ í•©ì„±ê³± ì‹ ê²½ë§ì´ íŒ¨ì…˜ MIST ë°ì´í„°ì…‹ì˜ ë¶„ë¥˜ ì •í™•ë„ë¥¼ ë†’ì´ê¸° ìœ„í•´ ìœ ìš©í•œ íŒ¨í„´ì„ í•™ìŠµí–ˆë‹¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>

<h2 id="6-2-í•¨ìˆ˜í˜•-api">6-2. í•¨ìˆ˜í˜• API</h2>
<p>ë§Œì•½ ì…ë ¥ì´ 2ê°œê³  ì¶œë ¥ì´ 2ê°œë¼ë©´ ì§€ê¸ˆê¹Œì§€ ì¼ë˜ <code class="language-plaintext highlighter-rouge">Sequential()</code> í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê¸° ì–´ë µë‹¤. ì´ ê²½ìš°ì—ëŠ” <strong>í•¨ìˆ˜í˜• API(Functional API)</strong>ë¥¼ ì‚¬ìš©í•œë‹¤. í•¨ìˆ˜í˜• APIëŠ” ì¼€ë¼ìŠ¤ì˜ Model í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë¸ì„ ë§Œë“ ë‹¤. ì¼ë‹¨ Dense ì¸µ 2ê°œë¥¼ ë§Œë“¤ì–´ë³´ì.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dense1</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'sigmoid'</span><span class="p">)</span>
<span class="n">dense2</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'softmax'</span><span class="p">)</span>
</code></pre></div></div>

<p>ì—¬ê¸°ì„œ ì „ì—ëŠ” <code class="language-plaintext highlighter-rouge">Sequential()</code> í´ë˜ìŠ¤ì˜ <code class="language-plaintext highlighter-rouge">add()</code> ë©”ì†Œë“œì— ìœ„ ê°ì²´ë“¤ì„ ì „ë‹¬í–ˆë‹¤. í•˜ì§€ë§Œ ë‹¤ìŒê³¼ ê°™ì´ í•¨ìˆ˜ì²˜ëŸ¼ í˜¸ì¶œë„ ê°€ëŠ¥í•˜ë‹¤.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hidden</span> <span class="o">=</span> <span class="n">dense1</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">dense2</span><span class="p">(</span><span class="n">hidden</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">)</span>
</code></pre></div></div>

<p>ì…ë ¥ì—ì„œ ì¶œë ¥ê¹Œì§€ ì¸µì„ í˜¸ì¶œí•œ ê²°ê³¼ë¥¼ ê³„ì† ì´ì–´ì£¼ê³ , Model í´ë˜ìŠ¤ì— ì…ë ¥ê³¼ ìµœì¢… ì¶œë ¥ì„ ì§€ì •í•œë‹¤. ì—¬ê¸°ì„œ inputsì€ ì–´ë””ì„œ ì™”ì„ê¹Œ? <code class="language-plaintext highlighter-rouge">Sequential()</code> í´ë˜ìŠ¤ëŠ” <code class="language-plaintext highlighter-rouge">InputLayer</code> í´ë˜ìŠ¤ë¥¼ ìë™ìœ¼ë¡œ ì¶”ê°€í•˜ê³  í˜¸ì¶œí•´ ì£¼ì—ˆë‹¤. í•˜ì§€ë§Œ <code class="language-plaintext highlighter-rouge">Model()</code> í´ë˜ìŠ¤ëŠ” ìš°ë¦¬ê°€ ìˆ˜ë™ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">InputLayer</code> í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ í˜¸ì¶œí•´ì•¼í•œë‹¤. ì¼€ë¼ìŠ¤ëŠ” <code class="language-plaintext highlighter-rouge">InputLayer</code>ë¥¼ ì‰½ê²Œ ë‹¤ë£° ìˆ˜ ìˆë„ë¡ <code class="language-plaintext highlighter-rouge">Input()</code> í•¨ìˆ˜ë¥¼ ë³„ë„ë¡œ ì œê³µí•œë‹¤.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">inputs</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">Inputs</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">784</span><span class="p">,))</span>
</code></pre></div></div>

<p>ì°¸ê³ ë¡œ ì¼€ë¼ìŠ¤ ëª¨ë¸ì€ <code class="language-plaintext highlighter-rouge">layers</code> ì†ì„± ì™¸ InputLayer ê°ì²´ë¥¼ í¬í•¨í•œ <code class="language-plaintext highlighter-rouge">_layers</code> ì†ì„±ì„ ë”°ë¡œ ê°€ì§€ê³  ìˆë‹¤. <code class="language-plaintext highlighter-rouge">Sequential</code> í´ë˜ìŠ¤ ê°ì²´ì˜ <code class="language-plaintext highlighter-rouge">_layers</code> ì†ì„± ì²« ë²ˆì§¸ í•­ëª©ì´ ë°”ë¡œ <code class="language-plaintext highlighter-rouge">InputLayer</code> í´ë˜ìŠ¤ì˜ ê°ì²´ì´ë‹¤. <code class="language-plaintext highlighter-rouge">InputLayer</code> í´ë˜ìŠ¤ëŠ” ëª¨ë¸ì˜ ì…ë ¥ì„ ì²« ë²ˆì§¸ ì€ë‹‰ì¸µì— ì „ë‹¬í•˜ëŠ” ì—­í• ì„ í•œë‹¤. ë”°ë¼ì„œ <code class="language-plaintext highlighter-rouge">InputLayer</code> ê°ì²´ì˜ ì…ë ¥ê³¼ ì¶œë ¥ì€ ë™ì¼í•˜ë‹¤. ì´ì œ ì „ì²´ë¥¼ í•©ì³ë³´ì!</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">inputs</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">784</span><span class="p">,))</span>
<span class="n">hidden</span> <span class="o">=</span> <span class="n">dense1</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">dense2</span><span class="p">(</span><span class="n">hidden</span><span class="p">)</span>
<span class="n">model2</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">)</span>
</code></pre></div></div>

<p>ìš°ë¦¬ëŠ” ì´ì œ íŠ¹ì„± ë§µ ì‹œê°í™”ë¥¼ ìˆ˜í–‰í•  ê²ƒì´ë‹¤. ê·¸ëŸ°ë° ì´ë¥¼ ìœ„í•´ì„œëŠ” í•¨ìˆ˜í˜• APIê°€ ê¼­ í•„ìš”í•˜ë‹¤. ì™œ ì¼ê¹Œ?<br />
ìš°ë¦¬ëŠ” 6-1 ì¥ì˜ ëª¨ë¸ì—ì„œ ì²« ë²ˆì§¸ <code class="language-plaintext highlighter-rouge">Conv2D</code> ì¶œë ¥ì´ í•„ìš”í•˜ë‹¤. ë§Œì•½ 6-1 ì¥ì˜ model ê°ì²´ ì…ë ¥ê³¼ <code class="language-plaintext highlighter-rouge">conv2D</code> ì¶œë ¥ì„ ì•Œ ìˆ˜ ìˆë‹¤ë©´, ì´ ë‘˜ì„ ì—°ê²°í•˜ì—¬ ìƒˆë¡œìš´ ëª¨ë¸ì„ ì–»ì„ ìˆ˜ ìˆì„ ê²ƒì´ë‹¤. ìš°ë¦¬ëŠ” ì²« ë²ˆì§¸ Conv2D ì¸µì´ ì¶œë ¥í•œ íŠ¹ì„± ë§µì„ ì›í•œë‹¤. ì²« ë²ˆì§¸ ì¸µì˜ ì¶œë ¥ì€ Conv2D ê°ì²´ì˜ output ì†ì„±ì—ì„œ ì–»ì„ ìˆ˜ ìˆë‹¤. <code class="language-plaintext highlighter-rouge">model.layers[0].output</code> ì²˜ëŸ¼ ì°¸ì¡°ê°€ ê°€ëŠ¥í•˜ë‹¤. model ê°ì²´ì˜ ì…ë ¥ì€ <code class="language-plaintext highlighter-rouge">input</code> ì†ì„±ìœ¼ë¡œ ì…ë ¥ì„ ì°¸ì¡°í•  ìˆ˜ ìˆë‹¤.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="nb">input</span><span class="p">)</span>
<span class="n">conv_acti</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">Model</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="nb">input</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">output</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ê²°ê³¼) Tensor("conv2d_4_input_2:0", shape=(None, 28, 28, 1), dtype=float32)
</code></pre></div></div>

<h2 id="6-3-íŠ¹ì„±-ë§µ-ì‹œê°í™”">6-3. íŠ¹ì„± ë§µ ì‹œê°í™”</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">train_input</span><span class="p">,</span> <span class="n">train_target</span><span class="p">),</span> <span class="p">(</span><span class="n">test_input</span><span class="p">,</span> <span class="n">test_target</span><span class="p">)</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">datasets</span><span class="p">.</span><span class="n">fashion_mnist</span><span class="p">.</span><span class="n">load_data</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">train_input</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s">'gray_r'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>
<p class="align-center"><img src="/assets/images/deeplearningtens/6-5.png" alt="ê·¸ë¦¼ 6-5. ì½”ë“œ ê²°ê³¼" /></p>
<p>ê·¸ë¦¼ 6-5. ì½”ë“œ ê²°ê³¼</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">inputs</span> <span class="o">=</span> <span class="n">train_input</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">].</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.0</span>
<span class="n">feature_maps</span> <span class="o">=</span> <span class="n">conv_acti</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">feature_maps</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ê²°ê³¼) (1, 28, 28, 32)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">].</span><span class="n">imshow</span><span class="p">(</span><span class="n">feature_maps</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:,</span><span class="n">i</span><span class="o">*</span><span class="mi">8</span><span class="o">+</span><span class="n">j</span><span class="p">])</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">].</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">conv2_acto</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">Model</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="nb">input</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">output</span><span class="p">)</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">train_input</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">].</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.0</span>
<span class="n">features_maps</span> <span class="o">=</span> <span class="n">conv_acti2</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">features_maps</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">].</span><span class="n">imshow</span><span class="p">(</span><span class="n">feature_maps</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:,</span><span class="n">i</span><span class="o">*</span><span class="mi">8</span><span class="o">+</span><span class="n">j</span><span class="p">])</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">].</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>
:ET
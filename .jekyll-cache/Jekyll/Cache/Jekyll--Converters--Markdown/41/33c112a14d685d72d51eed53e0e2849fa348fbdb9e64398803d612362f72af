I"`<p>ë³¸ í¬ìŠ¤íŒ…ì€ â€œí­ê·„ë¸Œë¡œì˜ 3ë¶„ ë”¥ëŸ¬ë‹, íŒŒì´í† ì¹˜ë§›â€ ì±… ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
ì˜ëª»ëœ ë‚´ìš©ì´ ìˆì„ ê²½ìš° ì§€ì í•´ ì£¼ì‹œë©´ ê°ì‚¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤.</p>

<h2 id="15-1-cganìœ¼ë¡œ-ì›í•˜ëŠ”-ì´ë¯¸ì§€-ìƒì„±í•˜ê¸°">15-1. cGANìœ¼ë¡œ ì›í•˜ëŠ” ì´ë¯¸ì§€ ìƒì„±í•˜ê¸°</h2>
<p>14ì¥ì—ì„œì˜ GAN ëª¨ë¸ì€ â€˜ì—¬ëŸ¬ ì¢…ë¥˜ì˜ íŒ¨ì…˜ ì•„ì´í…œ ì¤‘ ë¬´ì—‡ì„ ìƒì„±í•˜ë¼!â€™ ë¼ê³  ì§€ì‹œí•˜ëŠ” ë¡œì§ì´ ì—†ë‹¤. ì¦‰, ì‚¬ìš©ìê°€ ì›í•˜ëŠ” íŒ¨ì…˜ ì•„ì´í…œì„ ìƒì„±í•˜ëŠ” ëŠ¥ë ¥ì€ ì—†ê³  ë¬´ì‘ìœ„ ë²¡í„°ë¥¼ ì…ë ¥ë°›ì•„ ë¬´ì‘ìœ„ë¡œ íŒ¨ì…˜ ì•„ì´í…œì„ ì¶œë ¥í•˜ëŠ” ê²ƒì´ë‹¤.</p>

<p class="align-center">ì´ë²ˆì—ëŠ” ì¶œë ¥í•  ì•„ì´í…œì˜ ì¢…ë¥˜ë¥¼ ì…ë ¥ë°›ì•„ ê·¸ì— í•´ë‹¹í•˜ëŠ” ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ëŠ” ëª¨ë¸ì¸ ì¡°ê±´ë¶€ GAN <strong>cGAN(Conditional GAN)</strong>ì„ ë§Œë“¤ ê²ƒì´ë‹¤. ì´ë¥¼ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì€ ìƒì„±ìì™€ íŒë³„ìì˜ ì…ë ¥ì— ë ˆì´ë¸” ì •ë³´ë¥¼ ì´ì–´ë¶™ì´ëŠ” ê²ƒì´ë‹¤. cGANì—ì„œëŠ” ê·¸ë¦¼ì²˜ëŸ¼ ìƒì„±ìì™€ íŒë³„ìì— ë ˆì´ë¸” ì •ë³´ê°€ ë“¤ì–´ê°„ë‹¤.
<img src="/assets/images/deeplearningpyt/15-1.png" alt="ê·¸ë¦¼ 15-1. cGAN ëª¨ë¸ êµ¬ì¡°" /></p>
<p>ê·¸ë¦¼ 15-1. cGAN ëª¨ë¸ êµ¬ì¡°</p>

<h2 id="15-2-ì¡°ê±´ë¶€-ìƒì„±ìì™€-íŒë³„ì">15-2. ì¡°ê±´ë¶€ ìƒì„±ìì™€ íŒë³„ì</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torchvision</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="n">nn</span>
<span class="kn">import</span> <span class="nn">torch.optim</span> <span class="k">as</span> <span class="n">optim</span>
<span class="kn">from</span> <span class="nn">torchvision</span> <span class="kn">import</span> <span class="n">transforms</span><span class="p">,</span> <span class="n">datasets</span>
<span class="kn">from</span> <span class="nn">torchvision.utils</span> <span class="kn">import</span> <span class="n">save_image</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="c1"># í•˜ì´í¼íŒŒë¼ë¯¸í„°
</span><span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">USE_CUDA</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">is_available</span><span class="p">()</span>
<span class="n">DEVICE</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">"cuda"</span> <span class="k">if</span> <span class="n">USE_CUDA</span> <span class="k">else</span> <span class="s">"cpu"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Using Device: "</span><span class="p">,</span> <span class="n">DEVICE</span><span class="p">)</span>

<span class="c1"># Fashion MNIST ë°ì´í„°ì…‹
</span><span class="n">trainset</span> <span class="o">=</span> <span class="n">datasets</span><span class="p">.</span><span class="n">FashionMNIST</span><span class="p">(</span><span class="s">'./.data'</span><span class="p">,</span>
    <span class="n">train</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
    <span class="n">download</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
    <span class="n">transforms</span> <span class="o">=</span> <span class="n">transforms</span><span class="p">.</span><span class="n">Compose</span><span class="p">([</span>
      <span class="n">transforms</span><span class="p">.</span><span class="n">ToTensor</span><span class="p">(),</span>
      <span class="n">transforms</span><span class="p">.</span><span class="n">Normalize</span><span class="p">((</span><span class="mf">0.5</span><span class="p">,),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,))</span>
    <span class="p">]))</span>

<span class="n">train_loader</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">DataLoader</span><span class="p">(</span>
  <span class="n">dataset</span> <span class="o">=</span> <span class="n">trainset</span><span class="p">,</span>
  <span class="n">batch_size</span> <span class="o">=</span> <span class="n">BATCH_SIZE</span><span class="p">,</span>
  <span class="n">shuffle</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ê²°ê³¼) Using Device:  cpu
</code></pre></div></div>

<p>ì´ë²ˆ ì˜ˆì œì—ì„œëŠ” ìƒì„±ìì™€ íŒë³„ìê°€ í•˜ë‚˜ì˜ ì…ë ¥ê³¼ ë”ë¶ˆì–´ ë ˆì´ë¸” ì •ë³´ê¹Œì§€ ë‘ ê°€ì§€ ì…ë ¥ì„ ë°›ëŠ”ë‹¤. ë¬´ì‘ìœ„ í…ì„œ(z)ì˜ í¬ê¸°ëŠ” 100ìœ¼ë¡œ ì •í•˜ì. ìš°ë¦¬ëŠ” ë ˆì´ë¸”ì— ëŒ€í•œ ì •ë³´ë„ í¬ê¸° 10ì¸ í…ì„œë¡œ ë§Œë“¤ì–´ ë„£ì„ ê²ƒì´ë¯€ë¡œ ì²« ê³„ì¸µì€ 110ê°œì˜ ê°’ì„ ë°›ê²Œ ëœë‹¤. <code class="language-plaintext highlighter-rouge">embed()</code> í•¨ìˆ˜ëŠ” â€˜ë°°ì¹˜ x 1â€™ í¬ê¸°ì˜ ë ˆì´ë¸” í…ì„œë¥¼ ë°›ì•„ â€˜ë°°ì¹˜ x 10â€™ì˜ ì—°ì†ì ì¸ í…ì„œë¡œ ì „í™˜í•œë‹¤. ì´ë ‡ê²Œ í•˜ëŠ” ì´ìœ ëŠ” ì—°ì†ì ì¸ ê°’ì´ í•™ìŠµì— ë” ìœ ìš©í•˜ê¸° ë•Œë¬¸ì´ë‹¤!</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ìƒì„±ì
</span><span class="k">class</span> <span class="nc">Generator</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">()</span>

    <span class="bp">self</span><span class="p">.</span><span class="n">embed</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">Embedding</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="bp">self</span><span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">Sequential</span><span class="p">(</span>
      <span class="n">nn</span><span class="p">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span> <span class="mi">256</span><span class="p">),</span>
      <span class="n">nn</span><span class="p">.</span><span class="n">LeakyReLU</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="c1"># inplace=True ëŠ” ì…ë ¥ì„ ë³µì‚¬í•˜ì§€ ì•Šê³  ë°”ë¡œ ì¡°ì‘í•œë‹¤ëŠ” ëœ»!
</span>      <span class="n">nn</span><span class="p">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span>
      <span class="n">nn</span><span class="p">.</span><span class="n">LeakyReLU</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
      <span class="n">nn</span><span class="p">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">1024</span><span class="p">),</span>
      <span class="n">nn</span><span class="p">.</span><span class="n">LeakyReLU</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
      <span class="n">nn</span><span class="p">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">784</span><span class="p">),</span>
      <span class="n">nn</span><span class="p">.</span><span class="n">Tanh</span><span class="p">()</span>
    <span class="p">)</span>
  
  <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">embed</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">cat</span><span class="p">([</span><span class="n">z</span><span class="p">,</span> <span class="n">c</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># ë‘ ë²¡í„°ë¥¼ ì´ì–´ë¶™ì´ëŠ” ì—°ì‚°
</span>    <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div></div>
<p class="align-center"><img src="/assets/images/deeplearningpyt/15-2.png" alt="ê·¸ë¦¼ 15-2. cGAN ìƒì„±ì" /></p>
<p>ê·¸ë¦¼ 15-2. cGAN ìƒì„±ì</p>

<p>cGANì˜ íŒë³„ì ì—­ì‹œ ë ˆì´ë¸” ì •ë³´ë¥¼ ë°›ëŠ”ë‹¤. ì´ë•Œ ìƒì„±ìì—ì„œ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ë•Œ ì“´ ë ˆì´ë¸” ì •ë³´ë¥¼ ì…ë ¥ë°›ì•„ â€œë ˆì´ë¸”ì´ ì£¼ì–´ì¡Œì„ë•Œ ê°€ì§œì¸ í™•ë¥ ê³¼ ì§„ì§œì¸ í™•ë¥ â€ì„ ì¶”ì •í•œë‹¤ê³  ìƒê°í•˜ë©´ ëœë‹¤. íŒë³„ìì—ê²Œë„ ë ˆì´ë¸” ì •ë³´ë¥¼ ì „ë‹¬í•˜ê¸° ìœ„í•´ ì´ë¯¸ì§€ í¬ê²Œì´ 10ì„ ë”í•´ì¤€ë‹¤.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># íŒë³„ì
</span><span class="k">class</span> <span class="nc">Discriminator</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">()</span>

    <span class="bp">self</span><span class="p">.</span><span class="n">embed</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">Embedding</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="bp">self</span><span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">Sequential</span><span class="p">(</span>
      <span class="n">nn</span><span class="p">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">794</span><span class="p">,</span> <span class="mi">1024</span><span class="p">),</span>
      <span class="n">nn</span><span class="p">.</span><span class="n">LeakyReLU</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
      <span class="n">nn</span><span class="p">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.3</span><span class="p">),</span>
      <span class="n">nn</span><span class="p">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span>
      <span class="n">nn</span><span class="p">.</span><span class="n">LeakyReLU</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
      <span class="n">nn</span><span class="p">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.3</span><span class="p">),</span>
      <span class="n">nn</span><span class="p">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">256</span><span class="p">),</span>
      <span class="n">nn</span><span class="p">.</span><span class="n">LeakyReLU</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
      <span class="n">nn</span><span class="p">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.3</span><span class="p">),</span>
      <span class="n">nn</span><span class="p">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
      <span class="n">nn</span><span class="p">.</span><span class="n">Sigmoid</span><span class="p">()</span>
    <span class="p">)</span>
  
  <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">embed</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">cat</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div></div>
<p class="align-center"><img src="/assets/images/deeplearningpyt/15-3.png" alt="ê·¸ë¦¼ 15-3. cGAN íŒë³„ì" /></p>
<p>ê·¸ë¦¼ 15-3. cGAN íŒë³„ì</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ëª¨ë¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ê³  ëª¨ë¸ì˜ ê°€ì¤‘ì¹˜ë¥¼ ì§€ì •í•œ ì¥ì¹˜ë¡œ ë³´ë‚´ê¸°
</span><span class="n">D</span> <span class="o">=</span> <span class="n">Discriminator</span><span class="p">().</span><span class="n">to</span><span class="p">(</span><span class="n">DEVICE</span><span class="p">)</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">().</span><span class="n">to</span><span class="p">(</span><span class="n">DEVICE</span><span class="p">)</span>

<span class="c1"># ì´ì „ êµì°¨ ì—”íŠ¸ë¡œí”¼ ì˜¤ì°¨ í•¨ìˆ˜
</span><span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">BCELoss</span><span class="p">()</span>

<span class="c1"># ìƒì„±ìì™€ íŒë³„ìë¥¼ ìµœì í™”í•  Adam ëª¨ë“ˆ
</span><span class="n">d_optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="p">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">D</span><span class="p">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.0002</span><span class="p">)</span>
<span class="n">g_optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="p">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.0002</span><span class="p">)</span>
</code></pre></div></div>

<p>ë°ì´í„°ë¡œë”ì˜ ë‘ ë²ˆì§¸ ë°˜í™˜ê°’ë„ ì‚¬ìš©í•  ê²ƒì´ë¯€ë¡œ ë ˆì´ë¸” í‘œê¸°ë¥¼ í•´ì¤€ë‹¤. ê·¸ë¦¬ê³  ì¼ë°˜ GAN ì˜ˆì œì™€ ê°™ì´ ì§„ì§œì™€ ê°€ì§œ ë ˆì´ë¸”ì„ ë§Œë“ ë‹¤.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">total_step</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span>
<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">EPOCHS</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">train_loader</span><span class="p">):</span>
    <span class="n">images</span> <span class="o">=</span> <span class="n">images</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">).</span><span class="n">to</span><span class="p">(</span><span class="n">DEVICE</span><span class="p">)</span>

    <span class="c1"># 'ì§„ì§œ'ì™€ 'ê°€ì§œ' ë ˆì´ë¸” ìƒì„±
</span>    <span class="n">real_labels</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">ones</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="n">to</span><span class="p">(</span><span class="n">DEVICE</span><span class="p">)</span>
    <span class="n">fake_labels</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="n">to</span><span class="p">(</span><span class="n">DEVICE</span><span class="p">)</span>

    <span class="c1"># íŒë³„ìê°€ ì§„ì§œ ì´ë¯¸ì§€ë¥¼ ì§„ì§œë¡œ ì¸ì‹í•˜ëŠ” ì˜¤ì°¨ ê³„ì‚°(ë°ì´í„°ì…‹ ë ˆì´ë¸” ì…ë ¥)
</span>    <span class="n">label</span> <span class="o">=</span> <span class="n">labels</span><span class="p">.</span><span class="n">to</span><span class="p">(</span><span class="n">DEVICE</span><span class="p">)</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
    <span class="n">d_loss_real</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">real_labels</span><span class="p">)</span>
    <span class="n">real_score</span> <span class="o">=</span> <span class="n">outputs</span>

    <span class="c1"># ë¬´ì‘ìœ„ í…ì„œì™€ ë¬´ì‘ìœ„ ë ˆì´ë¸”ì„ ìƒì„±ìì— ì…ë ¥í•´ ê°€ì§œ ì´ë¯¸ì§€ ìƒì„±
</span>    <span class="n">z</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">randn</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">,</span> <span class="mi">100</span><span class="p">).</span><span class="n">to</span><span class="p">(</span><span class="n">DEVICE</span><span class="p">)</span>
    <span class="n">g_label</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">,)).</span><span class="n">to</span><span class="p">(</span><span class="n">DEVICE</span><span class="p">)</span> <span class="c1"># 0~9 ì¤‘ ëœë¤ìœ¼ë¡œ ì •ìˆ˜ 100ê°œ ìƒì„±
</span>    <span class="n">fake_images</span> <span class="o">=</span> <span class="n">G</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">g_label</span><span class="p">)</span>

    <span class="c1"># íŒë³„ìê°€ ê°€ì§œ ì´ë¯¸ì§€ë¥¼ ê°€ì§œë¡œ ì¸ì‹í•˜ëŠ” ì˜¤ì°¨ ê³„ì‚°
</span>    <span class="n">outputs</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="n">fake_images</span><span class="p">,</span> <span class="n">g_label</span><span class="p">)</span>
    <span class="n">d_loss_fake</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">fake_labels</span><span class="p">)</span>
    <span class="n">fake_score</span> <span class="o">=</span> <span class="n">outputs</span>

    <span class="c1"># ì§„ì§œì™€ ê°€ì§œ ì´ë¯¸ì§€ë¥¼ ê°–ê³  ë‚¸ ì˜¤ì°¨ë¥¼ ë”í•´ì„œ íŒë³„ìì˜ ì˜¤ì°¨ ê³„ì‚°
</span>    <span class="n">d_loss</span> <span class="o">=</span> <span class="n">d_loss_real</span> <span class="o">+</span> <span class="n">d_loss_fake</span>

    <span class="c1"># ì—­ì „íŒŒ ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ íŒë³„ì ëª¨ë¸ì˜ í•™ìŠµì„ ì§„í–‰
</span>    <span class="n">d_optimizer</span><span class="p">.</span><span class="n">zero_grad</span><span class="p">()</span>
    <span class="n">g_optimizer</span><span class="p">.</span><span class="n">zero_grad</span><span class="p">()</span>
    <span class="n">d_loss</span><span class="p">.</span><span class="n">backward</span><span class="p">()</span>
    <span class="n">d_optimizer</span><span class="p">.</span><span class="n">step</span><span class="p">()</span>

    <span class="c1"># ìƒì„±ìê°€ íŒë³„ìë¥¼ ì†ì˜€ëŠ”ì§€ì— ëŒ€í•œ ì˜¤ì°¨ ê³„ì‚°(ë¬´ì‘ìœ„ ë ˆì´ë¸” ì…ë ¥)
</span>    <span class="n">fake_iamges</span> <span class="o">=</span> <span class="n">G</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">g_label</span><span class="p">)</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="n">fake_images</span><span class="p">,</span> <span class="n">g_label</span><span class="p">)</span>
    <span class="n">g_loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">outptus</span><span class="p">,</span> <span class="n">real_labels</span><span class="p">)</span>

    <span class="c1"># ì—­ì „íŒŒ ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ìƒì„±ì ëª¨ë¸ì˜ í•™ìŠµì„ ì§„í–‰
</span>    <span class="n">d_optimizer</span><span class="p">.</span><span class="n">zero_grad</span><span class="p">()</span>
    <span class="n">g_optimizer</span><span class="p">.</span><span class="n">zero_grad</span><span class="p">()</span>
    <span class="n">g_loss</span><span class="p">.</span><span class="n">backward</span><span class="p">()</span>
    <span class="n">g_optimizer</span><span class="p">.</span><span class="n">step</span><span class="p">()</span>
  
  <span class="k">print</span><span class="p">(</span><span class="s">'ì´í­ [{}/{}] d_loss:{:.4f} g_loss: {:.4f} D(x):{:.2f} D(G(z):{:.2f}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">EPOCHS</span><span class="p">,</span> <span class="n">d_loss</span><span class="p">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">g_loss</span><span class="p">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">real_score</span><span class="p">.</span><span class="n">mean</span><span class="p">().</span><span class="n">item</span><span class="p">(),</span> <span class="n">fake_score</span><span class="p">.</span><span class="n">mean</span><span class="p">().</span><span class="n">item</span><span class="p">()))</span>
</code></pre></div></div>

:ET
I"Ö1<p>ë³¸ í¬ìŠ¤íŒ…ì€ â€œí˜¼ì ê³µë¶€í•˜ëŠ” ë¨¸ì‹ ëŸ¬ë‹+ë”¥ëŸ¬ë‹â€ ì±… ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
ì˜ëª»ëœ ë‚´ìš©ì´ ìˆì„ ê²½ìš° ì§€ì í•´ ì£¼ì‹œë©´ ê°ì‚¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤.</p>

<h2 id="6-1-ê°€ì¤‘ì¹˜-ì‹œê°í™”">6-1. ê°€ì¤‘ì¹˜ ì‹œê°í™”</h2>
<p>í•©ì„±ê³± ì¸µì€ ì—¬ëŸ¬ ê°œì˜ í•„í„°ë¥¼ ì‚¬ìš©í•´ ì´ë¯¸ì§€ì—ì„œ íŠ¹ì§•ì„ í•™ìŠµí•œë‹¤. ê° í•„í„°ëŠ” ì»¤ë„ì´ë¼ ë¶€ë¥´ëŠ” ê°€ì¤‘ì¹˜ì™€ ì ˆí¸ì„ ê°–ëŠ”ë‹¤. ì ˆí¸ì€ ì‚¬ì‹¤ ì‹œê°ì ìœ¼ë¡œ ì˜ë¯¸ê°€ ìˆì§€ëŠ” ì•Šë‹¤. ê°€ì¤‘ì¹˜ëŠ” ì…ë ¥ ì´ë¯¸ì§€ì˜ 2ì°¨ì› ì˜ì—­ì— ì ìš©ë˜ì–´ ì–´ë–¤ íŠ¹ì§•ì„ í¬ê²Œ ë‘ë“œëŸ¬ì§€ê²Œ í‘œí˜„í•˜ëŠ” ì—­í• ì„ í•œë‹¤.<br />
ë§Œì•½ ë‘¥ê·¼ ëª¨ì„œë¦¬ë¥¼ ë½‘ì•„ë‚´ëŠ” í•„í„°ê°€ ìˆë‹¤ê³  í•˜ì. ì´ í•„í„°ì˜ ê°€ì¤‘ì¹˜ëŠ” ë‘¥ê·¼ ëª¨ì„œë¦¬ê°€ ìˆëŠ” ì˜ì—­ì—ì„œ í¬ê²Œ í™œì„±í™” ë˜ê³ , ê·¸ë ‡ì§€ ì•Šì€ ì˜ì—­ì—ì„œëŠ” ë‚®ì€ ê°’ì„ ë§Œë“ ë‹¤. ì¦‰, ê³¡ì„  ë¶€ë¶„ì˜ ê°€ì¤‘ì¹˜ ê°’ì€ ë†’ê³ , ê·¸ ì™¸ ë¶€ë¶„ì˜ ê°€ì¤‘ì¹˜ ê°’ëŠ” ë‚®ì„ ê²ƒì´ë‹¤.<br />
5ì¥ì—ì„œ ë§Œë“  ëª¨ë¸ì„ ë¶ˆëŸ¬ì˜¤ì.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">models</span><span class="p">.</span><span class="n">load_model</span><span class="p">(</span><span class="s">'best-cnn-model.h5'</span><span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="n">layers</span>
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ê²°ê³¼) [&lt;tensorflow.python.keras.layers.convolutional.Conv2D at 0x245e6418f28&gt;,
       &lt;tensorflow.python.keras.layers.pooling.MaxPooling2D at 0x245e6447860&gt;,
       &lt;tensorflow.python.keras.layers.convolutional.Conv2D at 0x245e6487ba8&gt;,
       &lt;tensorflow.python.keras.layers.pooling.MaxPooling2D at 0x245e66b23c8&gt;,
       &lt;tensorflow.python.keras.layers.core.Flatten at 0x245e66b26a0&gt;,
       &lt;tensorflow.python.keras.layers.core.Dense at 0x245e66bc320&gt;,
       &lt;tensorflow.python.keras.layers.core.Dropout at 0x245e66bc710&gt;,
       &lt;tensorflow.python.keras.layers.core.Dense at 0x245e66bce48&gt;]
</code></pre></div></div>

<p>ì²« ë²ˆì§¸ í•©ì„±ê³± ì¸µì˜ ê°€ì¤‘ì¹˜ë¥¼ ë³´ì. ì¸µì˜ ê°€ì¤‘ì¹˜ì™€ ì ˆí¸ì€ <code class="language-plaintext highlighter-rouge">weights</code> ì†ì„±ì— ì €ì¥ë˜ì–´ ìˆë‹¤.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">conv</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">conv</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">shape</span><span class="p">,</span> <span class="n">conv</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ê²°ê³¼) (3, 3, 1, 32) (32,)
</code></pre></div></div>

<p>ì»¤ë„ í¬ê¸°ê°€ 3x3 ì´ì—ˆê³ , ì…ë ¥ì˜ ê¹Šì´ëŠ” 1ì´ì—ˆë‹¤. ì¶œë ¥ í•„í„° ê°œìˆ˜ê°€ 32ê°œ ì˜€ìœ¼ë¯€ë¡œ ì˜¬ë°”ë¥´ê²Œ ì¶œë ¥ë˜ì—ˆë‹¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. í•„í„°ë§ˆë‹¤ 1ê°œì˜ ì ˆí¸ì´ ìˆìœ¼ë¯€ë¡œ ì ˆí¸ë„ 32ê°œê°€ ë§ë‹¤. weights ì†ì„±ì€ ë‹¤ì°¨ì› ë°°ì—´ì¸ Tensor í´ë˜ìŠ¤ì˜ ê°ì²´ì´ë‹¤. ë‹¤ë£¨ê¸° ì‰½ë„ë¡ <code class="language-plaintext highlighter-rouge">numpy()</code> ë©”ì†Œë“œë¡œ ë„˜íŒŒì´ ë°°ì—´ë¡œ ë³€í™˜í•˜ê³  ê°€ì¤‘ì¹˜ ë°°ì—´ì˜ í‰ê· ê³¼ í‘œì¤€í¸ì°¨ë¥¼ êµ¬í•´ë³´ì.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">conv_weights</span> <span class="o">=</span> <span class="n">conv</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">numpy</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">conv_weights</span><span class="p">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">conv_weights</span><span class="p">.</span><span class="n">std</span><span class="p">())</span>
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ê²°ê³¼) -0.009519433 0.23307213
</code></pre></div></div>

<p>ê°€ì¤‘ì¹˜ì˜ í‰ê· ì´ 0ì— ê°€ê¹ê³ , í‘œì¤€í¸ì°¨ëŠ” 0.23 ì •ë„ì´ë‹¤. ì´ ê°€ì¤‘ì¹˜ê°€ ì–´ë–¤ ë¶„í¬ë¥¼ ê°€ì¡ŒëŠ”ì§€ í™•ì¸í•´ë³´ì.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="n">plt</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">conv_weights</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="c1"># (288, 1)
</span><span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'weight'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'count'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">,</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>
<p class="align-center"><img src="/assets/images/deeplearningtens/6-1.png" alt="ê·¸ë¦¼ 6-1. ì½”ë“œ ê²°ê³¼" /></p>
<p>ê·¸ë¦¼ 6-1. ì½”ë“œ ê²°ê³¼</p>

<p><code class="language-plaintext highlighter-rouge">hist()</code> í•¨ìˆ˜ë¡œ íˆìŠ¤í† ê·¸ë¨ì„ ê·¸ë¦¬ë ¤ë©´ 1ì°¨ì› ë°°ì—´ì´ ì „ë‹¬ë˜ì–´ì•¼ í•œë‹¤. íˆìŠ¤í† ê·¸ë¨ì„ ë³´ë©´ 0ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì¢… ëª¨ì–‘ ë¶„í¬ë¥¼ ë ê³  ìˆìŒì„ ë³¼ ìˆ˜ ìˆë‹¤. ì´ ì ì„ ì¼ë‹¨ ì£¼ëª©í•˜ì.<br />
ì´ë²ˆì—ëŠ” 32ê°œì˜ ì»¤ë„ì„ ì¶œë ¥í•´ë³´ì.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">].</span><span class="n">imshow</span><span class="p">(</span><span class="n">conv_weights</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="o">*</span><span class="mi">16</span><span class="o">+</span><span class="n">j</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">].</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>
<p class="align-center"><img src="/assets/images/deeplearningtens/6-2.png" alt="ê·¸ë¦¼ 6-2. ì½”ë“œ ê²°ê³¼" /></p>
<p>ê·¸ë¦¼ 6-2. ì½”ë“œ ê²°ê³¼</p>

<p>ë°ì€ ë¶€ë¶„ì˜ ê°’ì´ ê°€ì¥ ë†’ë‹¤í•  ìˆ˜ ìˆë‹¤. ì²« ë²ˆì§¸ ì¤„ì˜ ë§¨ ì™¼ìª½ ê°€ì¤‘ì¹˜ëŠ” ì˜¤ë¥¸ìª½ 3í”½ì…€ ê°’ì´ ê°€ì¥ ë†’ë‹¤. ì´ ê°€ì¤‘ì¹˜ëŠ” ì˜¤ë¥¸ìª½ì— ë†“ì¸ ì§ì„ ì„ ë§Œë‚˜ë©´ í¬ê²Œ í™œì„±í™” ë  ê²ƒì´ë‹¤. ì°¸ê³ ë¡œ <code class="language-plaintext highlighter-rouge">imshow()</code>ì˜ <code class="language-plaintext highlighter-rouge">vmin</code>ê³¼ <code class="language-plaintext highlighter-rouge">vmax</code>ëŠ” ì ˆëŒ€ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ í”½ì…€ì˜ ê°•ë„ë¥¼ ë‚˜íƒ€ë‚´ê¸° ìœ„í•´ ì‚¬ìš©í–ˆë‹¤. ì¦‰ ê·¸ ë°°ì—´ì˜ ìµœëŒ€ê°’ì´ë©´ ê°€ì¥ ë°ì€ ë…¸ë€ìƒ‰ìœ¼ë¡œ ê·¸ë¦¬ëŠ” ê²ƒì´ë‹¤.<br />
ì´ì œ í›ˆë ¨í•˜ì§€ ì•Šì€ ë¹ˆ í•©ì„±ê³± ì‹ ê²½ë§ì„ ë§Œë“¤ê³ , ì´ í•©ì„±ê³±ì˜ ê°€ì¤‘ì¹˜ê°€ ìœ„ ì½”ë“œì—ì„œ ë³¸ í›ˆë ¨ëœ ê°€ì¤‘ì¹˜ì™€ ì–´ë–»ê²Œ ë‹¤ë¥¸ì§€ ë³´ì.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">no_training_model</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">no_training_model</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s">'same'</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
<span class="n">no_training_conv</span> <span class="o">=</span> <span class="n">no_training_model</span><span class="p">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">no_training_conv</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">shape</span><span class="p">)</span>

<span class="n">no_training_weights</span> <span class="o">=</span> <span class="n">no_training_conv</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">numpy</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">no_training_weights</span><span class="p">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">no_training_weights</span><span class="p">.</span><span class="n">std</span><span class="p">())</span>

<span class="n">plt</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">no_training_weights</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'weight'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'count'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ê²°ê³¼) (3, 3, 1, 32)
       0.007826313 0.0833402
</code></pre></div></div>
:ET